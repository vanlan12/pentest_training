# Install Apache, MySQL, PHP (LAMP),PHPADMIN On Ubuntu

>Người thực hiện: Lưu Văn Lân

>Nguồn tài liệu: [INSTALL LAMP](https://www.digitalocean.com/community/tutorials/how-to-install-linux-apache-mysql-php-lamp-stack-on-ubuntu-16-04)

>Ngày đăng: 15/4/2017

# MỤC LỤC

[Chủ đề 1: Cài đặt APACHE và cho phép thiết lập FIREWALL](#1)
	
[Chủ đề 2: Cài đặt MySql](#2)

[Chủ đề 3: Cài Đặt PHP](#3)

[Chủ đề 4: Cài đặt phpMyAdmin](#4)

# NỘI DUNG
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

<a name="1"></a>
## Chủ đề 1: Cài đặt APACHE và cho phép thiết lập FIREWALL

### Cài đặt APACHE
- Để cài đặt APACHE --> Sử dụng những command sau:

```sh
    sudo apt-get update
    sudo apt-get install apache2
```
- Lúc này khi ta đang dùng lệnh `sudo` tức là thao tác trên quyền `root`. Nó sẽ hỏi ta mật khẩu người dùng của bạn để thực hiện lệnh.

### Thiết lập Global ServerName để ngăn chặn cảnh báo cú pháp

- Tiếp theo ta sẽ theo một dòng vào tệp `/etc/apache2/apache2.conf` để ngăn chặn cảnh báo. Mặc dù vô hại nhưng nếu ta không thiết lập `Server Name` toàn cầu, ta sẽ nhận được một cảnh báo khi kiểm tra cấu hình Apache như sau:
	
`$ sudo apache2ctl configtest`

```sh
Output
AH00558: apache2: Could not reliably determine the server's fully qualified domain name, using 127.0.1.1. Set the 'ServerName' directive globally to suppress this message
Syntax OK
```

- Tiến hành mở file cấu hình chính lên để chỉnh sửa:
`$ sudo nano /etc/apache2/apache2.conf`

	+Thêm vào một `ServerName directive` để trỏ tới tên miền chính của bạn. Nếu bạn không có tên miền liên kết với máy chủ của bạn thì bạn có thể sử dụng địa chỉ `IP PUBLIC` của bạn:
	
	```sh
	- Để xem được địa chỉ IP Public của mình bạn có thể sử dụng lệnh sau:
	
		+ip addr show eth0 | grep inet | awk '{ print $2; }' | sed 's/\/.*$//'

		+"eth0" ở đây là tên card mạng của bạn
	
	- Ở đây mình sử dụng địa chỉ IP local host : `127.0.0.1`
	```

![text](http://i.imgur.com/toQTtT3.png)

- Sau khi lưu file lại thì tiến hành kiểm tra cấu hình Apache lại lần nữa:

`$ sudo apache2ctl configtest`

Nhận được thông báo như thế này tức là bạn đã thành công:
```sh
Output
Syntax OK
```

- Tiến hành Reset lại Apache để cập nhật các thay đổi:

`$ sudo systemctl restart apache2`

-Lúc này bạn có thể tiến hành thiết lập Firewall

### Thiết lập Firewall để cho phép lưu lượng truy cập vào web
- Kiểm tra để đảm bảo tường lửa UFW đã có đủ thông tin các ứng dụng của Apache như sau:

`$ sudo ufw app list`

--->
```sh
Output
Available applications:
  Apache
  Apache Full
  Apache Secure
  OpenSSH
```

- Nếu bạn nhìn vào profile `Apache Full`, nó cho phép các lưu lượng truy cập port 80 và 443:

`$ sudo ufw app info "Apache Full"`

--->
```sh
Output
Profile: Apache Full
Title: Web Server (HTTP,HTTPS)
Description: Apache v2 is the next generation of the omnipresent Apache web
server.

Ports:
  80,443/tcp
```

- Cho phép lưu lượng truy cập vào các profile đó

`$ sudo ufw allow in "Apache Full"sudo ufw allow in "Apache Full"`

- Tiến hành kiểm tra bằng cách truy cập vào địa chủ IP Public của máy chủ trong trình duyệt web của bạn:

`http://your_server_IP_address`

- Nếu như bạn thấy được thông tin của Ubuntu 16.04 Apache như sau tức là bạn đã làm đúng:
![text](http://i.imgur.com/e0pI21d.png)
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

<a name="2"></a>
## Chủ đề 2: Cài đặt MySql

-Tiến hành cài đặt MySql bằng câu lệnh sau:
`$ sudo apt-get install mysql-server`
 
 >Lưu ý: Trong trường hợp này không nên chạy lệnh `sudo apt-get update` này trước lệnh cài đặt. Vì chúng ta đã chạy lệnh này lúc cài đặt Apache. 

- Sau khi Cài đặt xong tiến hành chạy một Script bảo mật đơn giản để xóa bỏ các thiết lập nguy hiểm và đồng thời khóa một số truy cập vào cơ sở dữ liệu của bạn. Tiến hành bằng câu lệnh:

`$ sudo mysql_secure_installation`

- Bạn sẽ được hỏi về password bạn muốn thiết lập cho tài khoản MySQL root. Tiếp theo bạn sẽ được hỏi nếu muốn cấu hình `VALIDATE PASSWORD PLUGIN`. Trả lời **y** để đồng ý.
```sh
VALIDATE PASSWORD PLUGIN can be used to test passwords
and improve security. It checks the strength of password
and allows the users to set only those passwords which are
secure enough. Would you like to setup VALIDATE PASSWORD plugin?

Press y|Y for Yes, any other key for No:
```

- Tiếp theo bạn sẽ được hỏi để chọn một cấp độ để xác nhận password.
```sh
There are three levels of password validation policy:

LOW    Length >= 8
MEDIUM Length >= 8, numeric, mixed case, and special characters
STRONG Length >= 8, numeric, mixed case, special characters and dictionary                  file

Please enter 0 = LOW, 1 = MEDIUM and 2 = STRONG: 1
```

-Nếu bạn có password root trước đó. Nó sẽ hỏi bạn có thay đổi password hay không.Bẩm **n** để đồng ý với mật khẩu hiện tại.
```
Using existing password for root.

Estimated strength of the password: 100
Change the password for root ? ((Press y|Y for Yes, any other key for No) : n
```

- Với các câu hỏi còn lại nên trả lời **Y** cho tất cả.  Nó sẽ an toàn hơn.

- Lúc này hệ thống cơ sở dữ liệu của bạn đã được thiết lập.

### Truy cập vào Mysql:
`$ sudo mysql -u root -p`

![text](http://i.imgur.com/SZQFon0.png)
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

<a name="3"></a>
## Chủ đề 3: Cài Đặt PHP

- Tiến hành cài đặt một số gói để đảm bảo php chạy dưới máy chủ Apache và nói chuyện được với cơ sở dữ liệu Mysql Của chúng ta bằng câu lệnh:

`$ sudo apt-get install php libapache2-mod-php php-mcrypt php-mysql`

- Bình thường khi một người dùng thực hiện một truy vấn lên máy chủ, Apache sẽ tìm và chạy file `index.html` trước. Và để thay đổi cho máy chủ web tìm và chạy file `index.php` trước ta thực hiện như sau:
	
	+Mở file `dir.conf`:
	`$ sudo nano /etc/apache2/mods-enabled/dir.conf`

	+Nó sẽ có dạng như sau:
![text](http://i.imgur.com/zMf0X4H.png)
	
	+Tiến hành di chuyển file index.php lên đầu:
![text](http://i.imgur.com/9Eqangy.png)
	
	+Lưu và đóng file bằng cách bấm `Ctrl-X`. Bấm `Y` để lưu.

- Tiến hành khởi động lại  Apache web server để cập nhật các thông tin:

	`$ sudo systemctl restart apache2`

#### Kiểm tra truy cập PHP vào máy chủ của bạn
- Tạo một file `info.php` vào đường dẫn `/var/www/html/` :
	`$ sudo nano /var/www/html/info.php`

- Tạo nội dung cho file `info.php` sau đó lưu và đóng file lại:
```sh
<?php
phpinfo();
?>
```

- Sử dụng trình duyệt web truy cập vào file đó:
`http://your_server_IP_address/info.php`

- Nếu như trang load ra như thế này tức là bạn đã thành công:
![text](http://i.imgur.com/GtjCRjN.png)

- Để remove file đó :
`$ sudo rm /var/www/html/info.php`

-Thử lại với file php khác:
![text](http://i.imgur.com/b46WXMP.png)
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

<a name="4"></a>
## Chủ đề 4: Cài đặt phpMyAdmin

- Tiến hành cài đặt phpMyAdmin
`$ sudo apt-get install phpmyadmin apache2-utils`

- Khi cài đặt ,phpMyAdmin sẽ hướng dẫn bạn cấu hình cơ bản. Thực hiện theo từng bước:
	+ Lựa chọn Apache2 cho Server
	+ Chọn Yes khi được hỏi về việc cấu hình cho cơ sở dữ liệu phpmyadmin
	+ Nhập Password Mysql
	+ Nhập Password mà bạn muốn truy cập vào PhpMyadmin

- Sau khi cài đặt thành công, thêm phpmyadmin vào cấu hình apache

`$ sudo nano /etc/apache2/apache2.conf`

Thêm phpmyadmin vào cuối file:

`Include /etc/phpmyadmin/apache.conf`

- Khởi động lại Apache:

`$ sudo service apache2 restart`

-Sau đó bạn có thể truy cập vào phpmyadmin bằng truy cập vào trình duyệt web theo đường dẫn `youraddress/phpmyadmin`

### Thiết lập bảo mật cho phpmyadmin

- Thiết lập cho  `.htaccess File` có thể truy cập vào phpmyadmin:

`sudo nano /etc/phpmyadmin/apache.conf `

Thêm vào dòng `AllowOverride All`  dưới cùng
```sh
<Directory /usr/share/phpmyadmin>
        Options FollowSymLinks
        DirectoryIndex index.php
        AllowOverride All
        [...]
```

- Thêm trang .htaccess vào đường dẫn phpmyadmin:
`sudo nano /usr/share/phpmyadmin/.htaccess`

-Theo dõi bằng cách thiết lập ủy quyền người dùng cho file .htaccess. Copy và Paste đoạn sau vào:
```sh
AuthType Basic
AuthName "Restricted Files"
AuthUserFile /etc/apache2/.phpmyadmin.htpasswd
Require valid-user
```

-Tạo một file htpasswd:

`sudo htpasswd -c /etc/apache2/.phpmyadmin.htpasswd username`

-->Chương trình sẽ nhắc bạn cung cấp và xác nhận password

-Kết thúc bằng cách reset lại apache:

`$ sudo service apache2 restart`

### Truy cập vào phpmyadmin
![text](http://i.imgur.com/7RUBclX.png)








































