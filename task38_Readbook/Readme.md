# Read Book: The Web Application Hacker’s Handbook

> Người thực hiện: Lưu Văn Lân

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------

# Web Application (In)security	

- Những ngày đầu thì Word Wide Web chỉ gồm các website. Thực chất là các kho thông tin chứa tài liệu tĩnh. 
![text](http://i.imgur.com/uof1nT0.png)

- Các kho trình duyệt web được phát minh như một phương tiện để truy xuất và hiển thị lượng thông tin được lưu trữ ở đây.

- Hầu hết các trang web không xác thực người dùng. Do đó bất kỳ mối đe dọa an ninh nào phát sinh từ host một trang web có liên quan nhiều đến lỗ hổng trong phần mềm máy chủ web.

- Nếu một kẻ tấn công tấn công vào máy chủ web, anh ta thường không thể truy cập vào các thông tin nhạy cảm nào bởi vì các thông tin đó đều được máy chủ cho xem ở chế độ public. Thay vào đó thì kẻ tấn công thường sửa các tập tin trên máy chủ để làm mất đi nội dung trên máy chủ hoặc sử dụng server's stogare và băng thông để phân phối "warez".

### [Tìm hiểu về warez](https://tinhte.vn/threads/warez-la-gi.2597860/)

- Còn hiện nay thì Word Wide Web có nhiều tính năng hơn. Chúng dựa vào 2 luồn thông tin từ server và trình duyệt .
![text](http://i.imgur.com/cprdBLz.png)

- Do ngày càng phát triển thì các các Web lại mang tới nhiều mối đe dọa bảo mật hơn.

- Một số chức năng nổi trội của Web hiện nay:
	+ Shopping(Amazon)
	+ Mạng xã hội(Face)
	+ Banking(Vietcombank)
	+ Websearch(Google)
	+ Đấu giá(Ebay)
	+ Cờ bạc(Betfair)
	+ Web logs(Bloger)
	+ Web mail(gmail)
	+ Tương tác thông tin(Wiki)

- HTTP giao thức truyền thông cốt lõi của Word Wide Web. Cung cấp khả năng phục hồi cao để giũ một kết nối mạng tới mọi người dùng. HTTP cũng có thể proxy và tunneled đến các giao thức khác , cho phép truyền thông an toàn hơn.

### Tài liệu: [proxy](https://vi.wikipedia.org/wiki/M%C3%A1y_ch%E1%BB%A7_proxy), [tunneled](https://en.wikipedia.org/wiki/Tunneling_protocol)	

## Các lỗ hổng ở các ứng dụng web thống kê từ 2007-2011:
- **Broken authentication** (62%) : Tấn công vào cơ chế đăng nhập của ứng dụng. Bằng cách đó khai khác thông qua các mật khẩu yếu, khởi động cách tấn công brute-force hoặc bypass the login

- **Broken access controls**(71%): Các ứng dụng thất bại trong việc bảo vệ truy cập vào các dữ liệu và các chức năng. Điều này tạo điều kiện cho kẻ tấn công có thể xem được các dữ liệu nhạy cảm của người dùng  trên máy chủ hoặc có thể thực hiện các hành động đặc quyền khác

- **SQL injection**(32%): Lỗ hổng này cho phép kẻ tấn công bằng cách thực hiện các thao tác truy nhập đơn giản gây các tác động lên các ứng dụng và cơ sở dữ liệu của nó. Kẻ tấn công có thể Lấy dữ liệu từ các tầng ứng dụng, Can thiệp và thực hiện các lệnh trên cơ sở dữ liệu của chính nó

- **Cross-site scipting**(94%): Lỗ hổng này cho phép kẻ tấn công hướng tới mục tiêu là các người dùng khác của ứng dụng, có khả năng tiếp cận được với dữ liệu của chúng. Thay mặc người dùng đó thực hiện các hành động trái phép hoặc thực hiện các cuộc tấn công khác chống lại họ

- **Information leakage**(78%):  Trường hợp này thì là các ứng dụng tiết lộ các thông tin nhạy cảm hiện đang sử dụng cho kẻ tấn công trong việc phát triển tấn công các ứng dụng, thông qua việc xử lí lỗi có lỗi hoặc hành vi khác

- **Cross-stie request forgery**(92%) :
![text](http://i.imgur.com/bIshifN.png)
	
>SSL là công nghệ tốt nhưng mặc dù vậy các ứng dụng web vẫn tồn tại rất nhiều lỗi hông web

## Vấn đề cốt lõi của bảo mật: Người dùng có thể nhập input tùy ý

- Vấn đè này được thể hiện qua các cách:
	+ Người dùng có thể can thiệp vào bất cứ dữ liệu chuyển tiếp giữa client và server, bao gồm các thông số truy vấn,cookies, và HTTP headers.Bất cứ sự kiểm soát bảo mật nào ở phía bên client, việc kiểm tra đầu vào, hoàn toàn có thể bị phá vỡ
	+ Người dùng có thể gửi truy vấn trong bất kỳ trình tự nào và có thể gửi các thông số tại một giai đoạn khác so với ứng dụng dự kiến, nhiều hơn một lần hoặc không phải tất cả.
	+ Người dùng không bị giới hạn việc chỉ sử dụng một trình duyệt web để truy cập các ứng dụng. Và có thể sử dụng tự do các công cụ tồn tại và trong đó có thể có các trình duyệt tấn công tới trình duyệt web

- Một số ví dụ về việc tự do nhập truy vấn sẽ đem tới các lỗi:
	+ Thay đổi giá của một sản phẩm được truyền đi trong một trường form HTML ẩn để gian lận về giá cả
	+ THay đổi một phiên vận chuyển trong một cookie HTTP để hack phiên chứng thực của người dùng
	+ Xóa đi một thông số nhất định nào đố để khai thác một lỗ hổng nào trong quá trình xử lí của ứng dụng
	+ THay đổi một số truy vấn đầu vào để truy cập vào back-end của cơ sở dữ liệu và khai thác các mục tiêu trong đó

## Core Defense Mechanisms
- Các cơ cấu bảo vệ ứng dụng gồm các cốt lõi như sau:
	+ Xử lí người dùng truy cập vào dữ liệu và chức năng của ứng dụng để ngăn chặn người dùng thực hiện các truy cập trái phép
	+ Xử lí đầu vào của người dùng ảnh hưỏng tới chức năng của ứng dụng để ngăn chặn các đầu vào sai phạm
	+ Xử lí kẻ tấn công để đảm bảo ứng dụng hoạt động thích hợp. Khi trở thành mục tiêu bị tấn công, thực hiện các biện pháp phòng thủ hợp lý
	+ Tự quản lý ứng dụng của mình bằng cách cho phép quản trị viên quản trị các hoạt động và thiết lập các chức năng

## Xử lí truy cập người dùng
------------------------------------------------------------------------------------------------------
- Hầu hết các ứng dụng web xử lí truy cập bằng cách sử dụng các cơ chế bảo mật:
	+ Athentication : Định danh
	+ Session management : QUản lí phiên
	+ Access control : Kiểm soát truy cập

## Xử lí đầu vào người dùng

## Các loại đầu vào người dùng

### Reject Known Bad

- Cách tiếp cận này tạo ra một danh sách đen để ngăn chặn các kí tự tồn tại trong danh sách đen đó khỏi đầu vào.

- Trong nhiều trường hợp các thiết lập để bỏ qua các kí tự có thể bị bỏ qua bằng cách dùng các kí tự không chuẩn nhưng có chức năng tương tự:
	+ Nếu **SELECT** bị khóa, thì thử **SeLeCt**
	+ Nếu **or 1=1--** bị khóa thì thử ** or 2=2--**
	+ Nếu `alert('xss')` bị khóa thì thử **prompt('xss')**

- Sử dụng các kí tự không chuẩn giữa các biểu thức để phá vỡ các quy luật

```sh
SELECT/*foo*/username,password/*foo*/FROM/*foo*/users
<img%09onerror=alert(1) src=a>
```

- Cuối cùng tồn tại trong danh sách đen, đặc biệt là các bộ lọc trong ứng dụng tưòng lửa của web , có thể bị khai thác bằng cách tấn công NULL byte. Chèn một byte NUll vào bất kì đâu trưóc khi kí tự đó bị khóa có thể gây ra một số  tiến trình làm dừng quá trình xử lí đầu vào và do đó không thể xác định được dạng của nó. Và nhờ đó đánh bại bộ lọc đầu vào.

`%00<script>alert(1)</script>`

### Accept Known Good

- Cái này là một danh sách trắng gồm các chuỗi các kí tự đưọc cho phép. Còn loại bỏ tất cả cái ngoài danh sách này.

### Sanitization

- Cách tiếp cận này thừa nhận sự cần thiết của việc đôi khi việc chấp nhận dữ liệu không thể mang lại sự an toàn. Thay vì từ chối đầu vào. Ứng dụng tự kiểm tra nó nhiều lần để ngăn khỏi việc nó có tác dụng phụ. Ví dụ cơ chế bảo vệ khoải tấn công cross-site scripting là đoạn mã HTML sẽ được mã hóa các kí tự nguy hiểm trước khi được nhúng vào mã nguồn của ứng dụng/

- Tuy nhiên cách này đạt đưọc nếu một số loại mã độc nguy hiểm cần được khai báo trong đầu vào

###  Xử lí dữ liệu đầu vào
- Nhiều lỗ hổng xuất hiện phát sinh do dữ liệu đầu vào của người dùng không an toàn. Lỗ hổng có thể đưọc tránh ra bằng cách khai báo dữ liệu đầu vào mà đảm bảo tiến trình của nó là an toàn

### Kiểm tra ngữ nghĩa
- Một số lỗ hổng mà đầu vào được cung cấp bởi kẻ tấn công giống hệt với đầu vào trước đó, đầu vào này không có gì độc hại và người dùng có thể chấp nhận nó. Tuy nhiên trong một số hoàn cảnh khác nhau thì đầu vào này lại gây ra độc hại. 

## Các cách ngăn chặn tấn công

- Xử lí lỗi
- Duy trì nhật kí kiểm toán
- Cảnh báo cho quản trị viên
- Phản ứng trước các cuộc tấn công

#### Note:
- Khi bất kỳ trình duyệt nào đó cố gắng kết nối máy chủ web, máy chủ web sẽ tạo ra phiên cho kết nối đó bằng mã thông báo phiên duy nhất, thường được gọi là Session ID. Phiên chứa thông tin khác nhau và session id hoặc session token của một phiên làm việc.

- Danh sách trắng không phải lúc nào cũng là hiệu quả để xác nhận đầu vào. Vì trong nhiều trường hợp ứng dụng phải chấp nhận dữ liệu và xử lí nó mà dữ liệu đó chưa được kiểm tra xem có an toàn hay không. Ví dụ như tên ngưòi có chứa các kí tự lạ có thể sử dụng để tấn công